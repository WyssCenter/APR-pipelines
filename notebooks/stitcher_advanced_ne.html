

<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  
  <title>Advanced stitching &mdash; paprica 0.0.1 documentation</title>
  

  
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../_static/mystnb.4510f1fc1dee50b3e5859aac5469c37c29e427902b24a333a5f9fcb2f0b3ac41.css" type="text/css" />

  
  

  
  

  

  
  <!--[if lt IE 9]>
    <script src="../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
        <script data-url_root="../" id="documentation_options" src="../_static/documentation_options.js"></script>
        <script src="../_static/jquery.js"></script>
        <script src="../_static/underscore.js"></script>
        <script src="../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../_static/js/theme.js"></script>

    
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
    <link rel="next" title="&lt;no title&gt;" href="../pipapr.html" />
    <link rel="prev" title="Stitch single channel data" href="stitcher.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../index.html" class="icon icon-home"> paprica
          

          
          </a>

          
            
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        
        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption" role="heading"><span class="caption-text">Documentation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../documentation.html">How to install</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../tutorials.html">Tutorials</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="parser_ne.html">Parse and load data-sets</a></li>
<li class="toctree-l2"><a class="reference internal" href="converter_ne.html">Batch convert voxel data to APR.</a></li>
<li class="toctree-l2"><a class="reference internal" href="stitcher.html">Stitch single channel data</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Advanced stitching</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#stitcher-tuning">Stitcher tuning</a></li>
<li class="toctree-l3"><a class="reference internal" href="#multichannel-stitching">Multichannel stitching</a></li>
</ul>
</li>
</ul>
</li>
</ul>
<p class="caption" role="heading"><span class="caption-text">API reference:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.atlaser.html">pipapr.atlaser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.batcher.html">pipapr.batcher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.converter.html">pipapr.converter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.loader.html">pipapr.loader</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.parser.html">pipapr.parser</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.segmenter.html">pipapr.segmenter</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.stitcher.html">pipapr.stitcher</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.viewer.html">pipapr.viewer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../pipapr.runner.html">pipapr.runner</a></li>
</ul>

            
          
        </div>
        
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../index.html">paprica</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          

















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../index.html" class="icon icon-home"></a> &raquo;</li>
        
          <li><a href="../tutorials.html">Tutorials</a> &raquo;</li>
        
      <li>Advanced stitching</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
          
            <a href="../_sources/notebooks/stitcher_advanced_ne.ipynb.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <section class="tex2jax_ignore mathjax_ignore" id="advanced-stitching">
<h1>Advanced stitching<a class="headerlink" href="#advanced-stitching" title="Permalink to this headline">¶</a></h1>
<section id="stitcher-tuning">
<h2>Stitcher tuning<a class="headerlink" href="#stitcher-tuning" title="Permalink to this headline">¶</a></h2>
<p>In this tutorial you will learn how to stitch multichannel data and how to change the stitcher option to obtain the best stitching results.</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pipapr</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">path</span> <span class="o">=</span> <span class="s1">&#39;../../../tests/data/apr&#39;</span>
<span class="n">tiles</span> <span class="o">=</span> <span class="n">pipapr</span><span class="o">.</span><span class="n">tileParser</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="n">path</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;apr&#39;</span><span class="p">,</span> <span class="n">frame_size</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
<span class="n">stitcher</span> <span class="o">=</span> <span class="n">pipapr</span><span class="o">.</span><span class="n">tileStitcher</span><span class="p">(</span><span class="n">tiles</span><span class="p">,</span> <span class="n">overlap_h</span><span class="o">=</span><span class="mi">25</span><span class="p">,</span> <span class="n">overlap_v</span><span class="o">=</span><span class="mi">25</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>By default, the stitcher uses entire tiles to compute the registration between each tile. If the tiles contains a lot of information or particular structures, it
might be necessary to reduce the number of planes included in the computation. To do so we provide a ´set_z_range´ method that here restrict the computation between plane 100 and 200:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stitcher</span><span class="o">.</span><span class="n">set_z_range</span><span class="p">(</span><span class="n">z_begin</span><span class="o">=</span><span class="mi">100</span><span class="p">,</span> <span class="n">z_end</span><span class="o">=</span><span class="mi">200</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>The overlap margin between tile can also be modified. By default, the pipeline use 20% more than the given overlap to register the tiles. Ideally this margin should be small enough to avoid spurious matches but <strong>must</strong> be large enough that the true overlaps are actually smaller than the one used for registration. If the true overlap is larger than the one used for the computation, then it is impossible for the pipeline to register correctly the tiles. Note that this limitation exists for many other pipelines and is not APR specific. The following allows to set the margin to 5%:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stitcher</span><span class="o">.</span><span class="n">set_overlap_margin</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>We also provide a way to avoid large displacements that can happen e.g. between two empty tiles. It basically sets the registration output to the expected one (given on the stitcher instantiation) if the computed displacement differs more than the one that is set. The associated reliability will be set low so that the global optimisation should avoid this computation anyway. In the following we set the regularisation parameter to 20 pixels for each dimension:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stitcher</span><span class="o">.</span><span class="n">set_regularization</span><span class="p">(</span><span class="n">reg_x</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">reg_y</span><span class="o">=</span><span class="mi">20</span><span class="p">,</span> <span class="n">reg_z</span><span class="o">=</span><span class="mi">20</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
<section id="multichannel-stitching">
<h2>Multichannel stitching<a class="headerlink" href="#multichannel-stitching" title="Permalink to this headline">¶</a></h2>
<p>The way multiple channel are stitched is very easy: we start by stitching a master channel (ideally the one that has nice signal and SNR) and we then register the other channels on the master channel. Let’s start by computing the registration of the previously loaded master channel:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">stitcher</span><span class="o">.</span><span class="n">compute_registration</span><span class="p">(</span><span class="n">progress_bar</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
<p>Then we can parse a second channel and register it to the master one:</p>
<div class="cell docutils container">
<div class="cell_input docutils container">
<div class="highlight-ipython2 notranslate"><div class="highlight"><pre><span></span><span class="n">tiles_ch2</span> <span class="o">=</span> <span class="n">pipapr</span><span class="o">.</span><span class="n">tileParser</span><span class="p">(</span><span class="n">path</span><span class="o">=</span><span class="s1">&#39;path to second channel&#39;</span><span class="p">,</span> <span class="n">ftype</span><span class="o">=</span><span class="s1">&#39;apr&#39;</span><span class="p">,</span> <span class="n">frame_size</span><span class="o">=</span><span class="mi">512</span><span class="p">)</span>
<span class="n">stitcher</span> <span class="o">=</span> <span class="n">pipapr</span><span class="o">.</span><span class="n">channelStitcher</span><span class="p">(</span><span class="n">stitcher</span><span class="o">=</span><span class="n">stitcher</span><span class="p">,</span> <span class="n">ref</span><span class="o">=</span><span class="n">tiles</span><span class="p">,</span> <span class="n">moving</span><span class="o">=</span><span class="n">tiles_ch2</span><span class="p">)</span>
</pre></div>
</div>
</div>
</div>
</section>
</section>


           </div>
           
          </div>
          <footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
        <a href="../pipapr.html" class="btn btn-neutral float-right" title="&lt;no title&gt;" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
        <a href="stitcher.html" class="btn btn-neutral float-left" title="Stitch single channel data" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>
        &#169; Copyright 2022, Wyss Center for Bio and Neuro Engineering.

    </p>
  </div>
    
    
    
    Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    
    provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>
        </div>
      </div>

    </section>

  </div>
  

  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>